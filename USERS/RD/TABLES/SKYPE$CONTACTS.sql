--DROP TABLE SKYPE$CONTACTS PURGE;
CREATE
TABLE SKYPE$CONTACTS
(
    ID INTEGER,
    IS_PERMANENT INTEGER,
    TYPE INTEGER,
    SKYPENAME VARCHAR2(4000 BYTE),
    PSTNNUMBER VARCHAR2(4000 BYTE),
    ALIASES VARCHAR2(4000 BYTE),
    FULLNAME VARCHAR2(4000 BYTE),
    BIRTHDAY INTEGER,
    GENDER INTEGER,
    LANGUAGES VARCHAR2(4000 BYTE),
    COUNTRY VARCHAR2(4000 BYTE),
    PROVINCE VARCHAR2(4000 BYTE),
    CITY VARCHAR2(4000 BYTE),
    PHONE_HOME VARCHAR2(4000 BYTE),
    PHONE_OFFICE VARCHAR2(4000 BYTE),
    PHONE_MOBILE VARCHAR2(4000 BYTE),
    EMAILS VARCHAR2(4000 BYTE),
    HASHED_EMAILS VARCHAR2(4000 BYTE),
    HOMEPAGE VARCHAR2(4000 BYTE),
    ABOUT VARCHAR2(4000 BYTE),
    AVATAR_IMAGE CLOB,
    MOOD_TEXT VARCHAR2(4000 BYTE),
    RICH_MOOD_TEXT VARCHAR2(4000 BYTE),
    "TIMEZONE" INTEGER,
    CAPABILITIES CLOB,
    PROFILE_TIMESTAMP INTEGER,
    NROF_AUTHED_BUDDIES INTEGER,
    IPCOUNTRY VARCHAR2(4000 BYTE),
    AVATAR_TIMESTAMP INTEGER,
    MOOD_TIMESTAMP INTEGER,
    RECEIVED_AUTHREQUEST VARCHAR2(4000 BYTE),
    AUTHREQ_TIMESTAMP INTEGER,
    LASTONLINE_TIMESTAMP INTEGER,
    AVAILABILITY INTEGER,
    DISPLAYNAME VARCHAR2(4000 BYTE),
    REFRESHING INTEGER,
    GIVEN_AUTHLEVEL INTEGER,
    GIVEN_DISPLAYNAME VARCHAR2(4000 BYTE),
    ASSIGNED_SPEEDDIAL VARCHAR2(4000 BYTE),
    ASSIGNED_COMMENT VARCHAR2(4000 BYTE),
    ALERTSTRING VARCHAR2(4000 BYTE),
    LASTUSED_TIMESTAMP INTEGER,
    AUTHREQUEST_COUNT INTEGER,
    ASSIGNED_PHONE1 VARCHAR2(4000 BYTE),
    ASSIGNED_PHONE1_LABEL VARCHAR2(4000 BYTE),
    ASSIGNED_PHONE2 VARCHAR2(4000 BYTE),
    ASSIGNED_PHONE2_LABEL VARCHAR2(4000 BYTE),
    ASSIGNED_PHONE3 VARCHAR2(4000 BYTE),
    ASSIGNED_PHONE3_LABEL VARCHAR2(4000 BYTE),
    BUDDYSTATUS INTEGER,
    ISAUTHORIZED INTEGER,
    POPULARITY_ORD INTEGER,
    EXTERNAL_ID VARCHAR2(4000 BYTE),
    EXTERNAL_SYSTEM_ID VARCHAR2(4000 BYTE),
    ISBLOCKED INTEGER,
    AUTHORIZATION_CERTIFICATE CLOB,
    CERTIFICATE_SEND_COUNT INTEGER,
    ACCOUNT_MODIFICATION_SERIAL_NR INTEGER,
    SAVED_DIRECTORY_BLOB CLOB,
    NR_OF_BUDDIES INTEGER,
    SERVER_SYNCED INTEGER,
    CONTACTLIST_TRACK INTEGER,
    LAST_USED_NETWORKTIME INTEGER,
    AUTHORIZED_TIME INTEGER,
    SENT_AUTHREQUEST VARCHAR2(4000 BYTE),
    SENT_AUTHREQUEST_TIME INTEGER,
    SENT_AUTHREQUEST_SERIAL INTEGER,
    BUDDYBLOB CLOB,
    CBL_FUTURE CLOB,
    NODE_CAPABILITIES INTEGER,
    REVOKED_AUTH INTEGER,
    ADDED_IN_SHARED_GROUP INTEGER,
    IN_SHARED_GROUP INTEGER,
    AUTHREQ_HISTORY CLOB,
    PROFILE_ATTACHMENTS CLOB,
    STACK_VERSION INTEGER,
    OFFLINE_AUTHREQ_ID INTEGER,
    NODE_CAPABILITIES_AND INTEGER,
    AUTHREQ_CRC INTEGER,
    AUTHREQ_SRC INTEGER,
    POP_SCORE INTEGER,
    AUTHREQ_NODEINFO CLOB,
    MAIN_PHONE VARCHAR2(4000 BYTE),
    UNIFIED_SERVANTS VARCHAR2(4000 BYTE),
    PHONE_HOME_NORMALIZED VARCHAR2(4000 BYTE),
    PHONE_OFFICE_NORMALIZED VARCHAR2(4000 BYTE),
    PHONE_MOBILE_NORMALIZED VARCHAR2(4000 BYTE),
    SENT_AUTHREQUEST_INITMETHOD INTEGER,
    AUTHREQ_INITMETHOD INTEGER,
    VERIFIED_EMAIL CLOB,
    VERIFIED_COMPANY CLOB,
    SENT_AUTHREQUEST_EXTRASBITMASK INTEGER,
    LIVEID_CID VARCHAR2(4000 BYTE),
    EXTPROP_SEEN_BIRTHDAY INTEGER,
    EXTPROP_SMS_TARGET INTEGER,
    EXTPROP_EXTERNAL_DATA VARCHAR2(4000 BYTE),
    IS_AUTO_BUDDY INTEGER,
    GROUP_MEMBERSHIP INTEGER,
    IS_MOBILE INTEGER,
    IS_TRUSTED INTEGER,
    AVATAR_URL VARCHAR2(4000 BYTE),
    FIRSTNAME VARCHAR2(4000 BYTE),
    LASTNAME VARCHAR2(4000 BYTE)
)
ORGANIZATION EXTERNAL
(
    TYPE ORACLE_LOADER
    DEFAULT DIRECTORY SQLITE
    ACCESS PARAMETERS
    (
        RECORDS DELIMITED BY NEWLINE
        SKIP 2
        CHARACTERSET UTF8
        NOBADFILE NOLOGFILE NODISCARDFILE
        STRING SIZES ARE IN BYTES
        DISABLE_DIRECTORY_LINK_CHECK
        PREPROCESSOR EXE:'SKYPE$CONTACTS.sh'
        FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '"'
        MISSING FIELD VALUES ARE NULL
        REJECT ROWS WITH ALL NULL FIELDS
        (
            ID CHAR,
            IS_PERMANENT CHAR,
            TYPE CHAR,
            SKYPENAME CHAR(4000),
            PSTNNUMBER CHAR(4000),
            ALIASES CHAR(4000),
            FULLNAME CHAR(4000),
            BIRTHDAY CHAR,
            GENDER CHAR,
            LANGUAGES CHAR(4000),
            COUNTRY CHAR(4000),
            PROVINCE CHAR(4000),
            CITY CHAR(4000),
            PHONE_HOME CHAR(4000),
            PHONE_OFFICE CHAR(4000),
            PHONE_MOBILE CHAR(4000),
            EMAILS CHAR(4000),
            HASHED_EMAILS CHAR(4000),
            HOMEPAGE CHAR(4000),
            ABOUT CHAR(4000),
            AVATAR_IMAGE CHAR(1048576),
            MOOD_TEXT CHAR(4000),
            RICH_MOOD_TEXT CHAR(4000),
            "TIMEZONE" CHAR,
            CAPABILITIES CHAR(1048576),
            PROFILE_TIMESTAMP CHAR,
            NROF_AUTHED_BUDDIES CHAR,
            IPCOUNTRY CHAR(4000),
            AVATAR_TIMESTAMP CHAR,
            MOOD_TIMESTAMP CHAR,
            RECEIVED_AUTHREQUEST CHAR(4000),
            AUTHREQ_TIMESTAMP CHAR,
            LASTONLINE_TIMESTAMP CHAR,
            AVAILABILITY CHAR,
            DISPLAYNAME CHAR(4000),
            REFRESHING CHAR,
            GIVEN_AUTHLEVEL CHAR,
            GIVEN_DISPLAYNAME CHAR(4000),
            ASSIGNED_SPEEDDIAL CHAR(4000),
            ASSIGNED_COMMENT CHAR(4000),
            ALERTSTRING CHAR(4000),
            LASTUSED_TIMESTAMP CHAR,
            AUTHREQUEST_COUNT CHAR,
            ASSIGNED_PHONE1 CHAR(4000),
            ASSIGNED_PHONE1_LABEL CHAR(4000),
            ASSIGNED_PHONE2 CHAR(4000),
            ASSIGNED_PHONE2_LABEL CHAR(4000),
            ASSIGNED_PHONE3 CHAR(4000),
            ASSIGNED_PHONE3_LABEL CHAR(4000),
            BUDDYSTATUS CHAR,
            ISAUTHORIZED CHAR,
            POPULARITY_ORD CHAR,
            EXTERNAL_ID CHAR(4000),
            EXTERNAL_SYSTEM_ID CHAR(4000),
            ISBLOCKED CHAR,
            AUTHORIZATION_CERTIFICATE CHAR(1048576),
            CERTIFICATE_SEND_COUNT CHAR,
            ACCOUNT_MODIFICATION_SERIAL_NR CHAR,
            SAVED_DIRECTORY_BLOB CHAR(1048576),
            NR_OF_BUDDIES CHAR,
            SERVER_SYNCED CHAR,
            CONTACTLIST_TRACK CHAR,
            LAST_USED_NETWORKTIME CHAR,
            AUTHORIZED_TIME CHAR,
            SENT_AUTHREQUEST CHAR(4000),
            SENT_AUTHREQUEST_TIME CHAR,
            SENT_AUTHREQUEST_SERIAL CHAR,
            BUDDYBLOB CHAR(1048576),
            CBL_FUTURE CHAR(1048576),
            NODE_CAPABILITIES CHAR,
            REVOKED_AUTH CHAR,
            ADDED_IN_SHARED_GROUP CHAR,
            IN_SHARED_GROUP CHAR,
            AUTHREQ_HISTORY CHAR(1048576),
            PROFILE_ATTACHMENTS CHAR(1048576),
            STACK_VERSION CHAR,
            OFFLINE_AUTHREQ_ID CHAR,
            NODE_CAPABILITIES_AND CHAR,
            AUTHREQ_CRC CHAR,
            AUTHREQ_SRC CHAR,
            POP_SCORE CHAR,
            AUTHREQ_NODEINFO CHAR(1048576),
            MAIN_PHONE CHAR(4000),
            UNIFIED_SERVANTS CHAR(4000),
            PHONE_HOME_NORMALIZED CHAR(4000),
            PHONE_OFFICE_NORMALIZED CHAR(4000),
            PHONE_MOBILE_NORMALIZED CHAR(4000),
            SENT_AUTHREQUEST_INITMETHOD CHAR,
            AUTHREQ_INITMETHOD CHAR,
            VERIFIED_EMAIL CHAR(1048576),
            VERIFIED_COMPANY CHAR(1048576),
            SENT_AUTHREQUEST_EXTRASBITMASK CHAR,
            LIVEID_CID CHAR(4000),
            EXTPROP_SEEN_BIRTHDAY CHAR,
            EXTPROP_SMS_TARGET CHAR,
            EXTPROP_EXTERNAL_DATA CHAR(4000),
            IS_AUTO_BUDDY CHAR,
            GROUP_MEMBERSHIP CHAR,
            IS_MOBILE CHAR,
            IS_TRUSTED CHAR,
            AVATAR_URL CHAR(4000),
            FIRSTNAME CHAR(4000),
            LASTNAME CHAR(4000)
        )
    )
    LOCATION('main.db')
)
NOPARALLEL
NOMONITORING
--REJECT LIMIT 100
;

/*
--test
SELECT ID,
IS_PERMANENT,
TYPE,
SKYPENAME,
PSTNNUMBER,
ALIASES,
FULLNAME,
BIRTHDAY,
GENDER,
LANGUAGES,
COUNTRY,
PROVINCE,
CITY,
PHONE_HOME,
PHONE_OFFICE,
PHONE_MOBILE,
EMAILS,
HASHED_EMAILS,
HOMEPAGE,
REPLACE(About, '\0A', CHR(10)) AS About,
AVATAR_IMAGE,
REPLACE(Mood_Text, '\0A', CHR(10)) AS Mood_Text,
REPLACE(Rich_Mood_Text, '\0A', CHR(10)) AS Rich_Mood_Text,
TIMEZONE,
CAPABILITIES,
PROFILE_TIMESTAMP,
NROF_AUTHED_BUDDIES,
IPCOUNTRY,
AVATAR_TIMESTAMP,
MOOD_TIMESTAMP,
RECEIVED_AUTHREQUEST,
AUTHREQ_TIMESTAMP,
LASTONLINE_TIMESTAMP,
AVAILABILITY,
DISPLAYNAME,
REFRESHING,
GIVEN_AUTHLEVEL,
GIVEN_DISPLAYNAME,
ASSIGNED_SPEEDDIAL,
ASSIGNED_COMMENT,
ALERTSTRING,
LASTUSED_TIMESTAMP,
AUTHREQUEST_COUNT,
ASSIGNED_PHONE1,
ASSIGNED_PHONE1_LABEL,
ASSIGNED_PHONE2,
ASSIGNED_PHONE2_LABEL,
ASSIGNED_PHONE3,
ASSIGNED_PHONE3_LABEL,
BUDDYSTATUS,
ISAUTHORIZED,
POPULARITY_ORD,
EXTERNAL_ID,
EXTERNAL_SYSTEM_ID,
ISBLOCKED,
AUTHORIZATION_CERTIFICATE,
CERTIFICATE_SEND_COUNT,
ACCOUNT_MODIFICATION_SERIAL_NR,
SAVED_DIRECTORY_BLOB,
NR_OF_BUDDIES,
SERVER_SYNCED,
CONTACTLIST_TRACK,
LAST_USED_NETWORKTIME,
AUTHORIZED_TIME,
SENT_AUTHREQUEST,
SENT_AUTHREQUEST_TIME,
SENT_AUTHREQUEST_SERIAL,
BUDDYBLOB,
CBL_FUTURE,
NODE_CAPABILITIES,
REVOKED_AUTH,
ADDED_IN_SHARED_GROUP,
IN_SHARED_GROUP,
AUTHREQ_HISTORY,
PROFILE_ATTACHMENTS,
STACK_VERSION,
OFFLINE_AUTHREQ_ID,
NODE_CAPABILITIES_AND,
AUTHREQ_CRC,
AUTHREQ_SRC,
POP_SCORE,
AUTHREQ_NODEINFO,
MAIN_PHONE,
UNIFIED_SERVANTS,
PHONE_HOME_NORMALIZED,
PHONE_OFFICE_NORMALIZED,
PHONE_MOBILE_NORMALIZED,
SENT_AUTHREQUEST_INITMETHOD,
AUTHREQ_INITMETHOD,
VERIFIED_EMAIL,
VERIFIED_COMPANY,
SENT_AUTHREQUEST_EXTRASBITMASK,
LIVEID_CID,
EXTPROP_SEEN_BIRTHDAY,
EXTPROP_SMS_TARGET,
EXTPROP_EXTERNAL_DATA,
IS_AUTO_BUDDY,
GROUP_MEMBERSHIP,
IS_MOBILE,
IS_TRUSTED,
AVATAR_URL,
FIRSTNAME,
LASTNAME
FROM SKYPE$CONTACTS
WHERE INSTR(About, '\0A') > 0;

SELECT *
FROM SKYPE$CONTACTS
WHERE SkypeName NOT IN
(
    SELECT Value
    FROM CONTACTDETAIL
    WHERE CommunicationType_ID = 
    (
        SELECT ID
        FROM COMMUNICATIONTYPE
        WHERE Name = 'Skype'
    )
);

SELECT E.GivenNames,
E.Surname,
TO_DATE(A.BirthDay, 'YYYYMMDD') AS Skype$DateBirth,
D.DateBirth
FROM SKYPE$CONTACTS A
INNER JOIN CONTACTDETAIL B
    ON A.SkypeName = B.Value
INNER JOIN COMMUNICATIONTYPE C
    ON B.CommunicationType_ID = C.ID
INNER JOIN PERSON D
    ON B.Person_ID = D.ID
LEFT OUTER JOIN PERSONNAME E
    ON B.Person_ID = E.Person_ID
WHERE C.Name = 'Skype'
AND TO_DATE(A.BirthDay, 'YYYYMMDD') <> COALESCE(D.DateBirth, TO_DATE('0001-01-01', 'YYYY-MM-DD'))
;
*/